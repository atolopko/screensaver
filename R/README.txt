Screensaver & cellHTS2
======================

Screensaver has support for analyzing screen result data using cellHTS2 
[http://www.bioconductor.org/packages/devel/bioc/html/cellHTS2.html], which is 
an analysis software package for cell-based RNAi screening data that runs in R 
[http://www.r-project.org/].  Screensaver provides its own cellHTS2Db R package
that works with cellHTS2, allowing Screensaver to send data and receive results
from the cellHTS2 package. Screensaver communicates with with R and cellHTS2Db
using Rserve [http://www.rforge.net/Rserve/], a TCP/IP server daemon.  Currently, 
R, cellHTS2Db, cellHTS2, and Rserve must be configured to run on the same 
host the one running Screensaver (although it should be possible to distribute 
the R process to a separate) host.


Required Software Versions
--------------------------

As of 2010-10-06, the following versions appear to be compatible: 
   * R 2.10.1
   * Rserve 0.6-2
   * Bioconductor 2.5
   * Biobase 2.6.1
   * cellHTS2 2.10.5
   * cellHTS2Db 0.42
  
We recommend running the cellHTS2Db tests to verify your own environment; 
see testing instructions below.   


Installation Instructions for R, Rserve, cellHTS2, and cellHTS2Db
-----------------------------------------------------------------

1. Install R

  For example, using Ubuntu GNU/Linux:

  $ sudo apt-get install r-base-core

  For example, using Debian GNU/Linux, as root:

  # apt-get install R

  For example, using Gentoo GNU/Linux, as root:

  # emerge R 


1a. On Ubuntu 10.04, libxml2-dev (apparently) needs to be installed:

  $ sudo apt-get install libxml2-dev 

2. Install cellHTS2:

  $ R
  > source("http://bioconductor.org/biocLite.R") 
  > biocLite("cellHTS2")

3. Install Screensaver's cellHTS2Db2 R package:

  $ R CMD INSTALL $SCREENSAVER/R/cellHTS2Db_0.42.tar.gz

  (To build and install the cellHTS2Db package from the latest Screensaver 
  source code, see notes below)

4. Install Rserve:

  $ R
  > install.packages('Rserve',,'http://www.rforge.net/')
  
5. Configure Screensaver to use cellHTS2.

  In screensaver.properties.web, set;
  
    screensaver.ui.feature.cellHTS2=true
    
  and edit the following properties to specify the directory and filenames to 
  be used for reports generated by cellHTS2:
  
    cellHTS2report.filepath.base=cellHTS2/output/
    cellHTS2report.filepath.prefix=cellHts2_output_screenResultId_
    
  Redploy/restart screensaver using the 'ant restart' command.


Starting Rserve
---------------

The Rserve daemon must be running in order for Screensaver to execute cellHTS2 
operations.  To start the Rserve daemon:

  $ R
  > library(cellHTS2Db)
  > library(Rserve)
  > Rserve()



FOR DEVELOPERS
==============

A description of the cellHTS2Db package can be found in cellHTS2Db-package.Rd. 
From within an R session this information is retrieved via help(cellHTS2Db).


Running R-based Unit Tests
--------------------------

The R-based unit tests are used to verify that the R code provided with 
Screensaver is functioning properly.

Install RUnit, if necessary:

  $ R
  > install.packages("RUnit")

Run tests in R:

  $ R
  > library(RUnit)
  > setwd("$SCREENSAVER/R/cellHTS2Db/tests")
  > testResult <- runTestFile("doRUnit.R")
  > printTextProtocol(testResult)


Installing and Building cellHTS2Db R package
--------------------------------------------

Install RUnit, if necessary:

  $ R
  > install.packages("RUnit")

To install the cellHTS2Db package from Screensaver source code:

   $ cd $SCREENSAVER/R/cellHTS2Db/inst/unitTests && make

The above command will all run the R-based unit tests, in doRUnit.R.
[See http://rwiki.sciviews.org/doku.php?id=developers:runit]

To create a cellHTS2DB package distribution file, first edit the version number 
and build dates in $SCREENSAVER/R/cellHTS2Db/DESCRIPTION, then run:

  $ cd $SCREENSAVER/R && R CMD build cellHTS2Db/
  
For general information about creating an R package see 
http://cran.r-project.org/doc/manuals/R-exts.pdf



Running Java-based Unit Tests
-----------------------------

The Java-based unit tests are used to verify that Screensaver application is 
functioning properly and can communicate with the R/cellHTS2 installation and 
a running Rserve daemon.  To run the tests:

  1. Follow the installation and Rserve start-up instructions, above.
  2. From within Eclipse, run the JUnit tests found in the test class
     edu.harvard.med.screensaver.analysis.cellhts2.CellHTS2Test
