<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:s="http://myfaces.apache.org/sandbox"
	xmlns:ss="http://screensaver.med.harvard.edu/ui">

<ui:composition template="/util/entityViewerDetails.xhtml">

  <ui:param name="entity" value="#{activityViewer.entity}" />
  <ui:param name="viewer" value="#{activityViewer}" />

  <ui:define name="propertiesContent">

    <ss:property id="activityType" label="Activity Type"
      description="The activity type"
      value="#{activityViewer.entity.activityTypeName}" />

    <ss:property id="dateOfActivity" label="Performed"
      description="The date the activity was performed in the lab"
      value="#{activityViewer.entity.dateOfActivity}" type="Date"
      required="true" editable="#{activityViewer.editMode}" />

		<ss:property id="concentration" label="Concentration"
			value="#{activityViewer.concentrationValue}"
      type="Concentration"
			unitsSelector="#{activityViewer.concentrationType}"
			description="concentration"
			rendered="#{activityViewer.entity.class.simpleName == 'LibraryScreening' || activityViewer.entity.class.simpleName == 'CherryPickScreening'}"
			editable="#{activityViewer.editMode}" />

		<ss:propertyGroup label="Screen">
      <ss:screenSummaryProperties
        screen="#{activityViewer.entity.screen}" />
    </ss:propertyGroup>

    <ss:property id="performedBy" label="Performed By"
      description="The person that is credited with performing the activity"
      value="#{activityViewer.performedBy}"
      editable="#{activityViewer.editMode}">
      <ui:define name="data">
        <ss:user user="#{value.selection}" />
      </ui:define>
      <ui:define name="editableData">
        <t:selectOneMenu id="performedByEditable" value="#{value.value}"
          styleClass="inputText selectMenu">
          <f:selectItems value="#{value.selectItems}" />
        </t:selectOneMenu>
      </ui:define>
    </ss:property>

    <!-- LibraryScreening properties -->

    <ss:property id="numberOfReplicates"
      label="No. of Replicates Screened"
      value="#{activityViewer.entity.numberOfReplicates}"
      description="The number of replicates screened"
      editable="#{activityViewer.editMode}" editWidth="2"
      rendered="#{activityViewer.entity.class.simpleName == 'LibraryScreening' || activityViewer.entity.class.simpleName == 'CherryPickScreening'}" />

    <ss:property id="volumeTransferredPerWell"
      label="Volume Transferred per Replicate"
			value="#{activityViewer.volumeTransferredPerWellValue}"
      type="Volume"
			unitsSelector="#{activityViewer.volumeTransferredPerWellType}"
			description="The volume transferred per replicate well"
      editable="#{activityViewer.editMode}" editWidth="6"
      rendered="#{activityViewer.entity.class.simpleName == 'LibraryScreening' || activityViewer.entity.class.simpleName == 'CherryPickScreening'}" />

    <ss:propertyGroup label="Assay Protocol" columns="1"
      rendered="#{activityViewer.entity.class.simpleName == 'LibraryScreening'}">
      <t:panelGrid columns="4" styleClass="layoutPanel"
        columnClasses="propertyLabelColumn,column,propertyLabelColumn,column">
        <ss:property id="assayProtocolType" label="Type"
          value="#{activityViewer.assayProtocolType}"
          description="'Preliminary' or 'Established'">
          <ui:define name="data">
            <t:selectOneMenu id="assayProtocolTypeEditable"
              value="#{value.value}"
              displayValueOnly="#{!activityViewer.editMode}"
              converter="#{assayProtocolTypeConverter}"
              styleClass="inputText selectMenu"
              displayValueOnlyStyleClass="selectMenu">
              <f:selectItems value="#{value.selectItems}" />
            </t:selectOneMenu>
          </ui:define>
        </ss:property>
        <ss:property id="assayProtocolLastModifiedDate"
          label="Last modified"
          value="#{activityViewer.entity.assayProtocolLastModifiedDate}"
          description="The date this assay protocol was last modified"
          type="Date" editable="#{activityViewer.editMode}" />
      </t:panelGrid>
      <ss:property id="assayProtocol" label="Protocol"
        value="#{activityViewer.entity.assayProtocol}" type="Textarea"
        editWidth="80" editHeight="5"
        description="The protocol used to conduct the assay screening"
        editable="#{activityViewer.editMode}" />
    </ss:propertyGroup>

    <ss:property id="screenerProvidedPlates" type="Boolean"
      submitOnChange="true" label="For screener-provided plates"
      value="#{activityViewer.entity.special}"
      description="Whether the library screening was performed on plates provided by the screener"
      rendered="#{activityViewer.entity.class.simpleName == 'LibraryScreening'}"
      editable="#{activityViewer.editMode &amp;&amp; activityViewer.libraryAndPlatesScreenedDataModel.rowCount == 0}" />

    <ss:property id="libraryPlatesScreened" label="Library Plates Screened"
      description="Plates screened by this library activity"
      rendered="#{activityViewer.entity.class.simpleName == 'LibraryScreening' &amp;&amp; !activityViewer.entity.special}">
      <ui:define name="data">
        <ss:collectionTable id="platesScreened"
          editable="#{activityViewer.editMode}"
          dataModel="#{activityViewer.libraryAndPlatesScreenedDataModel}"
          actionBean="#{activityViewer}" addAction="addPlatesScreened"
          deleteAction="deletePlatesScreened">
          <ui:define name="columns">
            <t:column>
              <f:facet name="header">
                <t:outputText value="Library" />
              </f:facet>
              <t:outputText
                value="#{empty element.library ? '' : element.library.shortName}"
                styleClass="dataText" />
              <t:outputText id="library2"
                rendered="#{!empty element.library}"
                value=" (#{element.library.startPlate}-#{element.library.endPlate})"
                styleClass="dataText" />
            </t:column>
            <t:column>
              <f:facet name="header">
                <t:outputText value="Start Plate" />
              </f:facet>
              <t:outputText id="startPlate"
                value="#{element.platesUsed.startPlate}"
                styleClass="dataText" />
            </t:column>
            <t:column>
              <f:facet name="header">
                <t:outputText value="End Plate" />
              </f:facet>
              <t:outputText id="endPlate"
                value="#{element.platesUsed.endPlate}"
                styleClass="dataText" />
            </t:column>
            <t:column>
              <f:facet name="header">
                <t:outputText value="Copy" />
              </f:facet>
              <t:outputText id="copy" value="#{element.platesUsed.copyName}"
                styleClass="dataText" />
            </t:column>
            <t:column rendered="#{activityViewer.editMode}">
              <f:facet name="header">
                <t:outputText value="Library Warning" />
              </f:facet>
              <t:outputText id="libraryWarning" value="#{element.adminLibraryWarning}"
                styleClass="dataText errorMessage" />
            </t:column>
          </ui:define>
          <ui:define name="addProperties">
            <t:panelGrid columns="6">
              <ss:property id="newPlatesScreenedStartPlate"
                label="Start Plate"
                value="#{activityViewer.newPlatesScreened.startPlate}"
                editable="true" />
              <ss:property id="newPlatesScreenedEndPlate"
                label="End Plate"
                value="#{activityViewer.newPlatesScreened.endPlate}"
                editable="true" />
              <ss:property id="newPlatesScreenedCopy" label="Copy"
                editable="true">
                <ui:define name="editableData">
                  <t:selectOneMenu id="newPlatesScreenedCopy"
                    value="#{activityViewer.newPlatesScreened.copyName}">
                    <t:selectItems value="#{activityViewer.allCopies}"
                      var="copyName" itemLabel="#{copyName}" itemValue="#{copyName}" />
                  </t:selectOneMenu>
                </ui:define>
              </ss:property>
            </t:panelGrid>
          </ui:define>
        </ss:collectionTable>
      </ui:define>
    </ss:property>

    <!-- CherryPickScreening properties -->

    <ss:property id="rcpsCherryPickRequest" label="For Cherry Pick Request"
      description="The cherry pick request for which this screening was performed"
      rendered="#{activityViewer.entity.class.simpleName == 'CherryPickScreening'}">
      <ui:define name="data">
        <ss:entityLink
          entity="#{activityViewer.entity.cherryPickRequest}"
          property="cherryPickRequestNumber"
          viewer="#{cherryPickRequestViewer}" />
      </ui:define>
    </ss:property>
    
    <ss:property id="cherryPickPlatesScreened" label="Cherry Pick Plates Screened"
      description="Cherry Pick Plates screened by this cherry pick screening activity"
      rendered="#{activityViewer.entity.class.simpleName == 'CherryPickScreening'}">
      <ui:define name="data">
        <t:dataTable id="cherryPickPlatesScreenedTable" forceId="true"
          var="row"
          value="#{activityViewer.cherryPickPlatesDataModel}"
          styleClass="standardTable" columnClasses="column"
          rowClasses="row1,row2" headerClass="tableHeader">
          <t:column>
            <f:facet name="header">
              <t:outputText value="Plate Number"/>
            </f:facet>
            <t:outputText value="#{row.data.plateOrdinal + 1}" />
          </t:column>
          <t:column>
            <f:facet name="header">
              <t:outputText value="Plate Name"/>
            </f:facet>
            <t:outputText value="&quot;#{row.data.name}&quot;" />
          </t:column>
          <t:column>
            <f:facet name="header">
              Plating Status
            </f:facet>
            <t:outputText value="#{row.data.statusLabel}" />
          </t:column>
          <t:column>
            <f:facet name="header">
              Screened During This Activity
            </f:facet>
            <t:selectBooleanCheckbox value="#{row.selected}"
              readonly="#{!activityViewer.editMode}" />
          </t:column>
        </t:dataTable>
      </ui:define>
    </ss:property>
    

    <!-- CherryPickLiquidTransfer properties -->

    <ss:property id="cpltCherryPickRequest" label="For Cherry Pick Request"
      description="The cherry pick request for which this liquid transfer was performed"
      rendered="#{activityViewer.entity.class.simpleName == 'CherryPickLiquidTransfer' &amp;&amp; !empty activityViewer.entity.cherryPickRequest}">
      <ui:define name="data">
        <ss:entityLink
          entity="#{activityViewer.entity.cherryPickRequest}"
          property="cherryPickRequestNumber"
          viewer="#{cherryPickRequestViewer}" />
      </ui:define>
    </ss:property>

    <ss:property id="cpltStatus" label="Plating Status"
      description="The outcome of the plating attempt"
      rendered="#{activityViewer.entity.class.simpleName == 'CherryPickLiquidTransfer' &amp;&amp; !empty activityViewer.entity.cherryPickRequest}"
      value="#{activityViewer.entity.status}">
    </ss:property>

    <ss:property id="cpltCherryPickPlates" label="Cherry Pick Plates "
      description="Cherry Pick Plates affected by this activity"
      rendered="#{activityViewer.entity.class.simpleName == 'CherryPickLiquidTransfer'}">
      <ui:define name="data">
        <t:dataTable id="cpltCherryPickPlatesTable" forceId="true"
          var="row"
          value="#{activityViewer.cherryPickPlatesDataModel}"
          styleClass="standardTable" columnClasses="column"
          rowClasses="row1,row2" headerClass="tableHeader">
          <t:column>
            <f:facet name="header">
              <t:outputText value="Plate Number"/>
            </f:facet>
            <t:outputText value="#{row.data.plateOrdinal + 1}" />
          </t:column>
          <t:column>
            <f:facet name="header">
              <t:outputText value="Plate Name"/>
            </f:facet>
            <t:outputText value="&quot;#{row.data.name}&quot;" />
          </t:column>
          <t:column>
            <f:facet name="header">
              Plating Status
            </f:facet>
            <t:outputText value="#{row.data.statusLabel}" />
          </t:column>
          <t:column>
            <f:facet name="header">
               Plated During This Activity
            </f:facet>
            <t:selectBooleanCheckbox value="#{row.selected}"
              readonly="#{true}" />
          </t:column>
        </t:dataTable>
      </ui:define>
    </ss:property>

    <ss:property id="comments" label="Comments"
      value="#{activityViewer.entity.comments}"
      editable="#{activityViewer.editMode}" description="Comments"
      type="Textarea" editWidth="80" editHeight="5" />

    <s:focus id="platesUsedFocuser"
      for="#{empty activityViewer.entity.dateOfActivity ? 'activityViewerForm:dateOfActivityDateField' : 'activityViewerForm:newPlatesScreenedStartPlateField'}" />

  </ui:define>



</ui:composition>

</html>

