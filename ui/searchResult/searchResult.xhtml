<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:s="http://myfaces.apache.org/sandbox">

<ui:component>

	<f:subview>

		<t:panelGrid id="searchAndColumnsPanel" columns="1" width="100%">
			<h:form>
				<t:collapsiblePanel id="columnsSelectionPanel" var="isCollapsed"
					rendered="#{!searchResults.capabilities[&quot;viewEntity&quot;] || searchResults.summaryView}">
					<f:facet name="header">
						<t:headerLink immediate="true">
							<t:outputText
								value="Columns #{isCollapsed ? &quot;&gt;&gt;&quot; : &quot;&lt;&lt;&quot;}"
								escape="true" styleClass="label" />
						</t:headerLink>
					</f:facet>
					<t:panelGrid id="columnsSelectionPanelInternal" columns="1">
						<t:commandButton id="updateColumnsButton" forceId="true"
							action="#{searchResults.columnManager.updateColumnSelections}"
							value="Update" styleClass="command"
							title="Update the columns selection" />
						<t:tree2 id="columnsSelectorTree"
							value="#{searchResults.columnManager.columnsTreeModel}"
							var="node" varNodeToggler="t" clientSideToggle="true"
							showRootNode="false">
							<f:facet name="root">
								<h:panelGroup>
									<h:outputText value="Columns" styleClass="label" />
								</h:panelGroup>
							</f:facet>
							<f:facet name="group">
								<h:panelGroup
									rendered="#{searchResults.readAdmin || node.description != &quot;Administrative&quot;}">
									<h:outputText value="#{node.description}" styleClass="label" />
								</h:panelGroup>
							</f:facet>
							<f:facet name="column">
								<h:panelGroup>
									<t:selectBooleanCheckbox id="columnSelector"
										value="#{node.checked}" styleClass="command" />
									<t:outputLabel for="columnSelector" value="#{node.description}"
										styleClass="label" />
								</h:panelGroup>
							</f:facet>
						</t:tree2>
					</t:panelGrid>
				</t:collapsiblePanel>
			</h:form>

			<h:form>
				<t:collapsiblePanel var="isCollapsed">
					<f:facet name="header">
						<t:headerLink immediate="true">
							<t:outputText
								value="Search #{isCollapsed ? &quot;&gt;&gt;&quot; : &quot;&lt;&lt;&quot;}"
								escape="true" styleClass="label" />
						</t:headerLink>
					</f:facet>

					<!-- Note: this button is the default form-submit button, invoked when user presses enter in an input text field -->
					<t:commandButton id="defaultSearchButton" forceId="true"
						styleClass="hiddenCommand" />

					<t:panelGrid styleClass="groupingPanel" style="margin-top: 2px">
						<t:dataTable id="queryTable" var="column"
							styleClass="standardTable"
							value="#{searchResults.columnManager.visibleColumns}"
							rendered="#{!searchResults.tableFilterMode}">
							<t:column id="columnName" styleClass="keyColumn"
								style="width: 33%">
								<t:outputText value="#{column.name}" styleClass="label" />
							</t:column>
							<t:column id="fieldOperatorColumn">
								<t:selectOneMenu id="operator"
									value="#{column.criterion.operator}"
									converter="#{operatorConverter}" styleClass="inputText">
									<f:selectItems value="#{column.columnType.operatorSelections}" />
								</t:selectOneMenu>
							</t:column>
							<t:column id="fieldInputColumn">
								<t:inputText id="simpleCriterionValue"
									value="#{column.criterion.value}"
									converter="#{column.converter}"
									rendered="#{column.columnType.name == &quot;TEXT&quot; || column.columnType.name == &quot;LIST&quot; || column.columnType.name == &quot;INTEGER&quot; || column.columnType.name == &quot;REAL&quot; || column.columnType.name == &quot;FIXED_DECIMAL&quot;}"
									size="#{column.columnType.name == &quot;TEXT&quot; ? 30 : 8}"
									styleClass="inputText" />
								<t:inputDate id="dateCriterionValue" type="date"
									popupCalendar="true" size="1" value="#{column.criterion.value}"
									rendered="#{column.columnType.name == &quot;DATE&quot;}"
									styleClass="inputText" />
								<t:selectOneMenu id="vocabularyCriterionValue"
									value="#{column.criterion.value}"
									converter="#{column.converter}"
									rendered="#{column.columnType.name == &quot;VOCABULARY&quot;}"
									styleClass="inputText">
									<f:selectItems value="#{column.vocabularySelections}" />
								</t:selectOneMenu>
								<t:selectOneMenu id="booleanCriterionValue"
									value="#{column.criterion.value}"
									converter="#{column.converter}"
									rendered="#{column.columnType.name == &quot;BOOLEAN&quot;}"
									styleClass="inputText">
									<f:selectItems value="#{column.booleanSelections}" />
								</t:selectOneMenu>
							</t:column>
							<t:column>
								<t:commandButton image="/images/delete.png" immediate="true"
									action="#{column.criterion.reset}" styleClass="command" />
							</t:column>
						</t:dataTable>
						<t:panelGroup id="searchCommandPanel">
							<!-- Note: this button is the default form-submit button, invoked when user presses enter in an input text field -->
							<t:commandButton id="searchButton" value="Search"
								styleClass="command" />
							<t:commandButton value="Reset" immediate="true"
								action="#{searchResults.resetFilter}" styleClass="command" />
							<t:selectBooleanCheckbox id="showFiltersInTableOption"
								value="#{searchResults.tableFilterMode}"
								onchange="javascript:document.getElementById('defaultSearchButton').click()" />
							<t:outputLabel for="showFiltersInTableOption"
								value="Show filters in table" styleClass="label" />
						</t:panelGroup>
					</t:panelGrid>
				</t:collapsiblePanel>
			</h:form>
		</t:panelGrid>

		<h:form>
			<t:buffer into="#{dataTableBuffer}">
				<t:dataTable id="searchResultsTable"
					binding="#{searchResults.dataTableUIComponent}"
					value="#{searchResults.dataTableModel}" var="row"
					rowIndexVar="rowIndex" rowCountVar="rowCount"
					rows="#{searchResults.rowsPerPage}" styleClass="standardTable"
					headerClass="tableHeader" rowClasses="row1,row2"
					sortColumn="#{searchResults.columnManager.sortColumnName}"
					sortAscending="#{searchResults.columnManager.sortAscending}"
					width="100%">

					<t:columns id="dataColumns"
						value="#{searchResults.columnManager.visibleColumnModel}"
						var="column"
						styleClass="#{column.numeric ? &quot;numericColumn&quot; : &quot;column&quot;}">
						<f:facet name="header">
							<t:panelGrid columns="1">
								<t:popup displayAtDistanceY="20">
									<!-- immediate="false" needed to allow UISelectMany components to be updated when sort is changed via clicking on table header -->
									<t:commandSortHeader columnName="#{column.name}" arrow="false"
										immediate="false">
										<f:facet name="ascending">
											<t:graphicImage value="/images/ascending-arrow.gif"
												rendered="true" border="0" />
										</f:facet>
										<f:facet name="descending">
											<t:graphicImage value="/images/descending-arrow.gif"
												rendered="true" border="0" />
										</f:facet>
										<t:outputText value="#{column.name}" />
									</t:commandSortHeader>
									<f:facet name="popup">
										<t:panelGrid styleClass="popupHelp">
											<t:outputText styleClass="popupText"
												value="#{column.description}" escape="false" />
										</t:panelGrid>
									</f:facet>
								</t:popup>

								<t:panelGrid id="tableColumnFilter" columns="1"
									headerClass="tableFilterPanel">
									<t:selectOneMenu id="operator"
										value="#{column.criterion.operator}"
										converter="#{operatorConverter}" styleClass="inputText"
										rendered="#{searchResults.tableFilterMode || !column.criterion.undefined}"
										displayValueOnly="#{!searchResults.tableFilterMode &amp;&amp; !column.criterion.undefined}"
										displayValueOnlyStyleClass="data">
										<f:selectItems value="#{column.columnType.operatorSelections}" />
									</t:selectOneMenu>
									<t:inputText id="simpleCriterionValue"
										value="#{column.criterion.value}"
										converter="#{column.converter}"
										rendered="#{(column.columnType.name == &quot;TEXT&quot; || column.columnType.name == &quot;INTEGER&quot; || column.columnType.name == &quot;REAL&quot; || column.columnType.name == &quot;FIXED_DECIMAL&quot;) &amp;&amp; (searchResults.tableFilterMode || !column.criterion.undefined)}"
										size="8" styleClass="inputText"
										displayValueOnly="#{!searchResults.tableFilterMode &amp;&amp; !column.criterion.undefined}"
										displayValueOnlyStyleClass="data"
										tabindex="#{searchResults.columnManager.currentColumnIndex + 1}" />
									<t:inputDate id="dateCriterionValue" type="date"
										popupCalendar="true" size="1"
										value="#{column.criterion.value}"
										rendered="#{column.columnType.name == &quot;DATE&quot; &amp;&amp; searchResults.tableFilterMode}"
										styleClass="inputText"
										tabindex="#{searchResults.columnManager.currentColumnIndex + 1}" />
									<t:outputText id="dateCriterionValueOutput"
										value="#{column.criterion.value}"
										rendered="#{column.columnType.name == &quot;DATE&quot; &amp;&amp; (!searchResults.tableFilterMode &amp;&amp; !column.criterion.undefined)}"
										styleClass="data" />
									<t:selectOneMenu id="vocabularyCriterionValue"
										value="#{column.criterion.value}"
										converter="#{column.converter}"
										rendered="#{column.columnType.name == &quot;VOCABULARY&quot; &amp;&amp; (searchResults.tableFilterMode || !column.criterion.undefined)}"
										styleClass="inputText"
										displayValueOnly="#{!searchResults.tableFilterMode &amp;&amp; !column.criterion.undefined}"
										displayValueOnlyStyleClass="data"
										onchange="javascript:document.getElementById('search').click()"
										tabindex="#{searchResults.columnManager.currentColumnIndex + 1}">
										<f:selectItems value="#{column.vocabularySelections}" />
									</t:selectOneMenu>
									<t:selectOneMenu id="booleanCriterionValue"
										value="#{column.criterion.value}"
										converter="#{column.converter}"
										rendered="#{column.columnType.name == &quot;BOOLEAN&quot; &amp;&amp; (searchResults.tableFilterMode || !column.criterion.undefined)}"
										styleClass="inputText"
										displayValueOnly="#{!searchResults.tableFilterMode &amp;&amp; !column.criterion.undefined}"
										displayValueOnlyStyleClass="data"
										onchange="javascript:document.getElementById('search').click()">
										<f:selectItems value="#{column.booleanSelections}" />
									</t:selectOneMenu>
									<t:panelGroup>
										<t:commandButton id="search" forceId="true" value="Search"
											styleClass="command"
											rendered="#{searchResults.tableFilterMode}" />
										<t:commandButton image="/images/delete.png" immediate="true"
											action="#{column.criterion.reset}" styleClass="command"
											rendered="#{searchResults.tableFilterMode}" />
									</t:panelGroup>
								</t:panelGrid>
							</t:panelGrid>
						</f:facet>
						<t:panelStack
							selectedPanel="#{searchResults.rowRestricted ? &quot;restricted&quot; : column.editable &amp;&amp; searchResults.editMode ? &quot;input&quot; : &quot;output&quot;}">
							<!-- this restricted field is a "last line of defense" against displaying data
                 that should not be viewable by the user; in general, a search result should
                 never contain restricted data to begin with -->
							<t:outputText id="restricted" value="- - -" />
							<!-- note: for editable input columns, we set tabindex to ensure tab behavior only moves between input fields (and not links in other non-editable columns) -->
							<t:inputText id="input" value="#{searchResults.cellValue}"
								rendered="#{column.editable &amp;&amp; searchResults.editMode}"
								immediate="true" converter="#{column.converter}"
								tabindex="#{rowIndex + searchResults.columnManager.currentColumnIndex + 1}" />
							<!-- both single-valued and collection column types are displayed in dataList -->
							<t:dataList id="output" var="item"
								value="#{searchResults.cellValue}" layout="simple"
								rowIndexVar="itemIndex" rowCountVar="itemCount">
								<t:commandLink disabled="#{! column.commandLink}"
									action="#{searchResults.cellAction}">
									<f:param name="commandValue"
										value="#{searchResults.escapeBackslashes[item]}" />
									<t:outputText id="text" value="#{item}" />
								</t:commandLink>
								<t:outputText value=";" rendered="#{itemIndex &lt; itemCount - 1}" />

							</t:dataList>
						</t:panelStack>
					</t:columns>
				</t:dataTable>

				<ui:insert name="searchResultFooter" />

				<t:panelGrid
					rendered="#{searchResults.capabilities[&quot;viewRowDetail&quot;] &amp;&amp; searchResults.rowDetailVisible &amp;&amp; !searchResults.editMode}"
					columns="1">
					<t:outputText value="Row Detail:" styleClass="subsection" />
					<t:aliasBean alias="#{rowDetail}"
						value="#{searchResults.capabilities[&quot;viewRowDetail&quot;] ? searchResults.rowDetail : null}">
						<t:outputText value="Coming soon!" />
					</t:aliasBean>
					<t:commandButton image="/images/delete.png"
						action="#{searchResults.hideRowDetail}" />
				</t:panelGrid>

				<t:panelGroup id="commandPanel">
					<t:panelGroup id="editCommandsPanel"
						rendered="#{searchResults.capabilities[&quot;editable&quot;]}">
						<t:commandButton id="editCommand" value="Edit"
							action="#{searchResults.edit}"
							rendered="#{searchResults.capabilities[&quot;editable&quot;] &amp;&amp; searchResults.hasEditableColumns &amp;&amp; !searchResults.editMode}" />
						<t:commandButton id="saveCommand" value="Save"
							action="#{searchResults.save}"
							rendered="#{searchResults.capabilities[&quot;editable&quot;] &amp;&amp; searchResults.hasEditableColumns &amp;&amp; searchResults.editMode}" />
						<t:commandButton id="cancelCommand" value="Cancel"
							immediate="true" action="#{searchResults.cancel}"
							rendered="#{searchResults.capabilities[&quot;editable&quot;] &amp;&amp; searchResults.hasEditableColumns &amp;&amp; searchResults.editMode}" />
					</t:panelGroup>

					<t:panelGrid id="downloadPanel"
						style="margin: 0px; border: 1px solid grey; padding: 1px;"
						border="0" cellpadding="0" cellspacing="0" columns="1"
						width="100%"
						rendered="#{searchResults.capabilities[&quot;exportData&quot;] &amp;&amp; searchResults.dataExporterSelector.size > 0}"
						title="Download search results to Excel spreadsheet or SD File">
						<t:panelGroup style="float: right">
							<t:outputText value="download search results to: " />
							<t:selectOneMenu id="downloadFormat"
								value="#{searchResults.dataExporterSelector.value}">
								<f:selectItems
									value="#{searchResults.dataExporterSelector.selectItems}" />
							</t:selectOneMenu>
							<t:commandButton id="downloadSearchResultsCommandButton"
								value="Download" action="#{searchResults.downloadSearchResults}" />
						</t:panelGroup>
					</t:panelGrid>
				</t:panelGroup>
			</t:buffer>

			<ui:include src="/util/dataTableNavigator.xhtml">
				<ui:param name="dataTable" value="#{searchResults}" />
			</ui:include>

			<t:outputText value="#{dataTableBuffer}" escape="false"
				rendered="#{!searchResults.capabilities[&quot;viewEntity&quot;] || !searchResults.entityView}" />
		</h:form>

		<t:panelGroup
			rendered="#{searchResults.capabilities[&quot;viewEntity&quot;] &amp;&amp; searchResults.entityView}">
			<ui:insert name="entityViewer">
				<t:outputText value="entityViewer ain't got no body" />
			</ui:insert>
		</t:panelGroup>

	</f:subview>

</ui:component>

</html>
