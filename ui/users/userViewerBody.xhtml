<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:s="http://myfaces.apache.org/sandbox"
	xmlns:ss="http://screensaver.med.harvard.edu/ui">

<ui:composition>

	<h:form id="userViewerForm">
		<t:div rendered="#{!empty userViewer.user}">

			<t:panelGroup id="commandPanel" rendered="#{userViewer.editable}">
				<ss:editSaveCancel viewer="#{userViewer}" />
          <t:commandButton action="#{userViewer.addScreen}"
            id="addScreenCommand" value="Add Screen"
            rendered="#{userViewer.screensaverUser.isUserInRoleOfNameMap['screensAdmin'] &amp;&amp; !userViewer.editMode &amp;&amp; userViewer.screeningRoomUserViewMode &amp;&amp; !empty userViewer.user.entityId}"
            styleClass="command" />
			</t:panelGroup>

			<t:panelGrid id="userProperties" columns="2"
				columnClasses="propertyLabelColumn,column" styleClass="layoutPanel">

				<ss:property id="userId" label="User #"
					description="The number used to uniquely identify the user"
					value="#{userViewer.user.screensaverUserId}"
					rendered="#{userViewer.readAdmin}" />

				<ss:property id="dateCreated" label="Created"
					description="The date the user was originally recorded in Screensaver"
					value="#{userViewer.user.dateCreated}" type="Date"
					rendered="#{userViewer.readAdmin}" />

				<ss:property id="fullName" label="Name"
					description="The name and email of the user"
					value="#{userViewer.user.fullNameFirstLast}"
					required="true"
					rendered="#{!userViewer.editMode}"/>

				<ss:property id="firstName" label="First Name"
					description="The user's first name"
					value="#{userViewer.user.firstName}"
					rendered="#{userViewer.editMode}" editable="#{userViewer.editMode}" editWidth="60"/>

				<ss:property id="lastName" label="Last Name"
					description="The user's last name (surname)"
					value="#{userViewer.user.lastName}"
					required="true"
					rendered="#{userViewer.editMode}" editable="#{userViewer.editable}" editWidth="60"/>

				<ss:property id="email" label="Email"
					description="The user's email address "
					value="#{userViewer.user.email}" editable="#{userViewer.editMode}"
					editWidth="60" />

				<ss:property id="ecommonsId" label="eCommons ID"
					description="The user's eCommons ID "
					value="#{userViewer.user.ECommonsId}"
					rendered="#{userViewer.readAdmin}"
					editable="#{userViewer.editMode}" />

				<ss:property id="harvardId" label="Harvard ID"
					description="The user " value="#{userViewer.user.harvardId}"
					rendered="#{userViewer.readAdmin}"
					editable="#{userViewer.editMode}" />

				<ss:property id="harvardIdExpiration" type="Date"
					label="Harvard ID Initial Expiration Date"
					description="The date when the user's Harvard ID will expire"
					value="#{userViewer.user.harvardIdExpirationDate}"
					rendered="#{userViewer.readAdmin}"
					editable="#{userViewer.editMode}">
					<!-- TODO: ui:define name="valueFooter">
					  <t:outputText id="harvardIdExpirationWarning" value="#{userViewer.harvardIdExpired ? 'Expired!' : userViewer.harvardIdDaysUntilExpiration}"/>
					</ui:define -->
				</ss:property>

				<ss:property id="phone" label="Phone"
					description="The user's phone number"
					value="#{userViewer.user.phone}" editable="#{userViewer.editMode}" />

				<ss:property id="mailingAddress" label="Mailing Address"
					type="Textarea" description="The user's mailing address"
					value="#{userViewer.user.mailingAddress}"
					editable="#{userViewer.editMode}" editWidth="80" editHeight="4" />

        <ss:property id="comments" label="Comments"
          type="Textarea" description="Comments about this user"
          value="#{userViewer.user.comments}"
          rendered="#{userViewer.readAdmin}"
          editable="#{userViewer.editMode}" editWidth="80" editHeight="4" />

				<ss:property id="classification" label="Classification"
					description="The user's classification"
					value="#{userViewer.user.userClassification}"
					editable="#{userViewer.editMode &amp;&amp; !userViewer.user.headOfLab}"
					converter="#{screeningRoomUserClassificationConverter}"
					required="true">
					<ui:define name="editableData">
						<t:selectOneMenu id="classificationMenu"
							value="#{userViewer.user.userClassification}"
							converter="#{screeningRoomUserClassificationConverter}"
							required="true"
							styleClass="inputText selectMenu">
							<f:selectItems value="#{userViewer.userClassificationSelections}" />
						</t:selectOneMenu>
					</ui:define>
				</ss:property>

				<ss:property id="labName" label="Lab Name"
					description="The name of the user's current lab"
					value="#{userViewer.user.lab.labName}"
					editable="#{userViewer.editMode &amp;&amp; !userViewer.user.headOfLab}">
					<ui:define name="data">
						<ss:labName user="#{userViewer.user}" />
					</ui:define>
					<ui:define name="editableData">
						<t:selectOneMenu id="labNameMenu"
							value="#{userViewer.labName.value}"
							styleClass="inputText selectMenu">
							<f:selectItems value="#{userViewer.labName.selectItems}" />
						</t:selectOneMenu>
					</ui:define>
				</ss:property>

				<ss:property id="labAffiliation"
					label="#{'Lab Affiliation'}"
					description="The organization the user is affiliated with (usually via his/her lab)"
					value="#{userViewer.user.lab.labAffiliation.affiliationName}"
					editable="#{userViewer.editMode &amp;&amp; userViewer.user.headOfLab}">
					<ui:define name="editableData">
						<t:selectOneMenu id="labAffiliationMenu"
							value="#{userViewer.labAffiliation.value}"
							styleClass="inputText selectMenu">
							<f:selectItems value="#{userViewer.labAffiliation.selectItems}" />
						</t:selectOneMenu>

						<t:div id="newLabAffiliationDiv" styleClass="groupingPanel">
							<t:panelGrid columns="1" columnClasses="column">
								<ss:propertyGroup id="newLabAffiliationGroup"
									label="New Affiliation (optional)">
									<ss:property id="newLabAffiliationName" label="Name"
										description="The name of the new affiliation to be created"
										value="#{userViewer.newLabAffiliation.affiliationName}"
										editable="true" editWidth="60" />
									<ss:property id="newLabAffiliationCategory" label="Category"
										description="The name of the new affiliation to be created"
										value="#{userViewer.newLabAffiliation.affiliationCategory}"
										editable="true">
										<ui:define name="editableData">
											<t:selectOneMenu id="affiliationCategoryMenu"
												value="#{value}" styleClass="inputText selectMenu"
												converter="#{affiliationCategoryConverter}">
												<f:selectItems
													value="#{userViewer.affiliationCategorySelections}" />
											</t:selectOneMenu>
										</ui:define>
									</ss:property>
								</ss:propertyGroup>
							</t:panelGrid>
							<t:commandButton id="addNewLabAffiliation" value="Add"
								action="#{userViewer.addNewLabAffiliation}" />
						</t:div>
					</ui:define>
				</ss:property>

				<ss:property id="roles" label="Roles"
					description="The roles of this user"
					value="#{userViewer.user.screensaverUserRoles}"
					rendered="#{userViewer.readAdmin}">
					<ui:define name="valueHeader">
						<t:outputText value="Non-screening user of our facility"
							styleClass="dataText errorMessage"
							rendered="#{!userViewer.editMode &amp;&amp; !userViewer.user.isUserInRoleOfNameMap['readEverythingAdmin'] &amp;&amp; !userViewer.user.isUserInRoleOfNameMap['screeningRoomUser']}" />
					</ui:define>
					<ui:define name="data">
						<ss:collectionTable id="rolesTable"
							editable="#{userViewer.editMode}"
							dataModel="#{userViewer.userRolesDataModel}"
							actionBean="#{userViewer}" addAction="addUserRole"
							deleteAction="deleteUserRole">
							<ui:define name="columns">
                <t:column>
                  <f:facet name="header">
										<t:outputText value="Role" styleClass="label" />
									</f:facet>
									<t:outputText
                    value="#{element.displayableRoleName}"
                    styleClass="dataText" />
                </t:column>
							</ui:define>
							<ui:define name="addProperties">
								<t:panelGrid columns="2">
									<ss:property id="newrole" label="Role" editable="true">
										<ui:define name="editableData">
											<t:selectOneMenu id="newUserRole"
												value="#{userViewer.newUserRole.value}"
												styleClass="inputText selectMenu">
												<f:selectItems value="#{userViewer.newUserRole.selectItems}" />
											</t:selectOneMenu>
										</ui:define>
									</ss:property>
								</t:panelGrid>
							</ui:define>
						</ss:collectionTable>
					</ui:define>
				</ss:property>

			</t:panelGrid>
		</t:div>
	</h:form>

</ui:composition>

</html>
