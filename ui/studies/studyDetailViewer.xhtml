<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:s="http://myfaces.apache.org/sandbox"
  xmlns:ss="http://screensaver.med.harvard.edu/ui">

<!-- TODO: share common code with screenDetailViewer -->

<ui:composition>

	<h:form id="studyDetailPanelForm">
		<t:collapsiblePanel id="studyDetailPanel"
			value="#{studyDetailViewer.panelCollapsed}"
			title="Study Summary" var="isCollapsed" titleVar="title">
			<f:facet name="header">
				<ss:roundedDiv>
					<t:headerLink immediate="true" styleClass="transparentSectionHeader">
						<h:graphicImage
							value="#{isCollapsed ? &quot;/images/collapsed.png&quot; : &quot;/images/expanded.png&quot;}"
							styleClass="icon" />
						<h:outputText value="Study Summary" styleClass="transparentSectionHeader"
							rendered="#{isCollapsed}" />
						<h:outputText value="Study Details" styleClass="transparentSectionHeader"
							rendered="#{!isCollapsed}" />
					</t:headerLink>
				</ss:roundedDiv>
			</f:facet>

			<f:facet name="closedContent">
				<t:panelGrid columns="1">
					<t:outputText value="#{studyDetailViewer.study.screenNumber}: &quot;#{studyDetailViewer.study.title}&quot;"
							styleClass="dataText" />
					<t:div>
						<t:outputText value="Lab:" styleClass="label" />
						<t:outputText value="#{studyDetailViewer.study.labHead.lab.labName}"
							styleClass="dataText" />
						<t:outputText value="&#160;&#160;Study Lead:" styleClass="label"
							escape="false" />
						<t:outputText
							value="#{studyDetailViewer.study.leadScreener.fullNameLastFirst}"
							styleClass="dataText" />
					</t:div>
				</t:panelGrid>
			</f:facet>

			<t:panelGrid id="labelsAndDataColumns" columns="2"
				styleClass="standardTable" rowClasses="row1,row2"
				columnClasses="keyColumn,column">

				<t:outputLabel for="screenId" value="Screen ID"
					visibleOnUserRole="developer"
					title="The database ID for the screen. This is an implementation-level detail displayed only for development purposes" />
				<t:outputText id="screenId"
					value="#{studyDetailViewer.study.screenId}" styleClass="dataText"
					visibleOnUserRole="developer" />

				<t:outputLabel for="screenNumber" value="Study Number"
					title="The number used to uniquely identify the study" />
				<t:outputText id="screenNumber"
					value="#{studyDetailViewer.study.screenNumber}"
					styleClass="dataText" />

				<t:outputLabel for="title" value="Title"
					title="The title of the screen" />
				<t:inputText id="title" value="#{studyDetailViewer.study.title}"
					displayValueOnly="#{true}" size="80"
					styleClass="inputText" displayValueOnlyStyleClass="dataText" />

				<t:outputLabel for="studyType" value="Study Type"
					title="'In Vitro' or 'In Silico'" />
				<t:outputText id="studyType"
					value="#{studyDetailViewer.study.studyType}"
					styleClass="dataText" />

				<t:outputLabel for="screenType" value="Library Screen Type"
					title="'Small Molecule' or 'RNAi'" />
				<t:outputText id="screenType"
					value="#{studyDetailViewer.study.screenType}"
					converter="#{screenTypeConverter}" styleClass="dataText" />

				<t:outputLabel for="studyIsShareable" value="Shareable"
					title="True when the study is shareable with scientists outside the lab" />
				<t:div>
					<t:selectBooleanCheckbox id="studyIsShareable"
						value="#{studyViewer.study.shareable}" styleClass="label"
						displayValueOnly="#{studyDetailViewer.readOnly}"
						displayValueOnlyStyleClass="dataText" />
				</t:div>

				<!-- "lab name" == last name of "lab head", but former is required for UI, latter is for internal design -->
				<t:outputLabel for="labName" value="Lab Name"
					title="The name of the lab carrying out the study" />
				<h:panelGroup>
					<t:outputText id="labName"
						value="#{studyDetailViewer.study.labHead.lab.labName}"
						styleClass="dataText" style="margin-right: 4px" />
					<t:outputText value=" (" styleClass="dataText" />
					<h:outputLink
						value="mailto:#{studyDetailViewer.study.labHead.email}">
						<t:outputText id="labHeadEmail"
							value="#{studyDetailViewer.study.labHead.email}"
							styleClass="dataText " />
					</h:outputLink>
					<t:outputText value=")" styleClass="dataText" />
				</h:panelGroup>

				<t:outputLabel for="leadScreener" value="Lead Screener"
					title="The scientist primarily responsible for carrying out the study" />
				<h:panelGroup>
					<t:outputText id="leadScreener"
						value="#{studyDetailViewer.study.leadScreener.fullNameLastFirst}"
						styleClass="dataText" style="margin-right: 4px" />
					<t:outputText value=" (" styleClass="dataText" />
					<h:outputLink
						value="mailto:#{studyDetailViewer.study.leadScreener.email}">
						<t:outputText id="leadScreenerEmail"
							value="#{studyDetailViewer.study.leadScreener.email}"
							styleClass="dataText" />
					</h:outputLink>
					<t:outputText value=")" styleClass="dataText" />
				</h:panelGroup>

				<t:outputLabel for="collaborators" value="Collaborators"
					title="Other scientists involved in carrying out the screen" />
				<t:panelGrid columns="1" styleClass="layoutPanel">
					<t:outputText value="&lt;none&gt;" styleClass="dataText"
						rendered="#{empty studyDetailViewer.study.collaborators}" />
					<t:dataTable id="collaborators" var="collaborator"
						value="#{studyDetailViewer.study.collaborators}"
						styleClass="standardTable" columnClasses="column"
						rendered="#{!empty studyDetailViewer.study.collaborators}">
						<t:column>
							<t:outputText value="#{collaborator.fullNameLastFirst}"
								styleClass="dataText" />
							<t:outputText value=" (" styleClass="dataText" />
							<t:outputText value="#{collaborator.lab.labName}"
								styleClass="dataText" />
							<t:outputText value=")" styleClass="dataText" />
						</t:column>
					</t:dataTable>
				</t:panelGrid>

				<t:outputLabel for="dateCreated" value="Created"
					title="The date the study was added to the Screensaver" />
				<t:outputText id="dateCreated"
					value="#{studyDetailViewer.study.dateCreated}"
					styleClass="dataText" />

				<t:outputLabel for="summary" value="Summary"
					title="A summary of the study" />
				<t:inputTextarea id="summary" rows="3" cols="80"
					value="#{studyDetailViewer.study.summary}"
					displayValueOnly="#{true}"
					displayValueOnlyStyleClass="dataText" />

				<t:outputLabel for="url" value="Home page"
					title="A URL for the home page of the study" />
				<h:outputLink id="url" value="#{studyDetailViewer.study.url}">
					<t:outputText value="#{studyDetailViewer.study.url}" styleClass="dataText"/>
				</h:outputLink>

				<t:outputLabel for="publications" value="Publications"
					title="Publications reporting results of the screen" />
				<t:panelGrid columns="1">
					<t:outputText value="&lt;none&gt;" styleClass="dataText"
						rendered="#{empty studyDetailViewer.study.publications}" />
					<t:dataTable id="publications" var="publication"
						value="#{studyDetailViewer.publicationsDataModel}"
						preserveDataModel="false"
						rendered="#{!empty studyDetailViewer.study.publications}"
						styleClass="standardTable" rowClasses="row1,row2"
						columnClasses="column" headerClass="tableHeader">
						<t:column>
							<f:facet name="header">
								<t:outputText value="Pubmed ID" />
							</f:facet>
							<h:outputLink
								value="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi">
								<f:param name="cmd" value="Search" />
								<f:param name="db" value="PubMed" />
								<f:param name="term" value="#{publication.pubmedId}[PMID]" />
								<t:outputText value="#{publication.pubmedId}" />
							</h:outputLink>
						</t:column>
						<t:column>
							<f:facet name="header">
								<t:outputText value="Year" />
							</f:facet>
							<t:inputText value="#{publication.yearPublished}"
								displayValueOnly="#{true}" maxlength="4"
								styleClass="inputText" displayValueOnlyStyleClass="dataText" />
						</t:column>
						<t:column>
							<f:facet name="header">
								<t:outputText value="Title" />
							</f:facet>
							<t:inputText value="#{publication.title}"
								displayValueOnly="#{true}"
								styleClass="inputText" displayValueOnlyStyleClass="dataText" />
						</t:column>
						<t:column>
							<f:facet name="header">
								<t:outputText value="Authors" />
							</f:facet>
							<t:inputText value="#{publication.authors}"
								displayValueOnly="true"
								styleClass="inputText" displayValueOnlyStyleClass="dataText" />
						</t:column>
					</t:dataTable>
				</t:panelGrid>

				<t:outputLabel for="comments" value="Comments"
					rendered="#{studyDetailViewer.readAdmin}"
					title="Administrative comments" />
				<t:inputTextarea id="comments" rows="3" cols="80"
					value="#{studyDetailViewer.study.comments}"
					rendered="#{studyDetailViewer.readAdmin}"
					displayValueOnly="#{studyDetailViewer.readAdmin}"
					styleClass="inputText" displayValueOnlyStyleClass="dataText" />

			</t:panelGrid>
		</t:collapsiblePanel>

	</h:form>

</ui:composition>

</html>
