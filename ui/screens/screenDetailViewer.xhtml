<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:s="http://myfaces.apache.org/sandbox"
	xmlns:ss="http://screensaver.med.harvard.edu/ui">

<!--
TODO:
- add URL field
- provide file upload for attached file
-->

<ui:composition>

	<h:form id="screenDetailPanelForm">
		<ss:collapsiblePanel id="screenDetail"
			isCollapsed="#{screenDetailViewer.panelCollapsed}"
			label="Screen Summary">

			<ui:define name="closedContent">
				<f:subview id="screenSummary">
					<t:panelGrid columns="4">
						<ss:screenSummaryProperties screen="#{screenDetailViewer.screen}" />
					</t:panelGrid>
				</f:subview>
			</ui:define>

			<ui:define name="content">
				<t:panelGroup id="commandPanel">
					<h:commandButton id="viewAdminOnlyFieldsCommand"
						value="#{screenDetailViewer.adminViewMode ? 'Hide Admin' : 'Show Admin'}"
						rendered="#{(screenDetailViewer.editable || screenDetailViewer.readAdmin) &amp;&amp; !screenDetailViewer.editMode}"
						action="#{screenDetailViewer.toggleAdminViewMode}"
						styleClass="command"
						title="Show or hide administrative fields for the screen" />
					<ss:editSaveCancel viewer="#{screenDetailViewer}" />
				</t:panelGroup>

				<t:panelGrid id="leftAndRightSides" columns="2"
					columnClasses="column,column" styleClass="standardTable">
					<t:panelGrid id="leftSide" columns="2"
						columnClasses="propertyLabelColumn,column"
						styleClass="layoutPanel">

						<ss:screenSummaryProperties screen="#{screenDetailViewer.screen}"
							editable="#{screenDetailViewer.editMode}">
							<ui:define name="editableLabHead">
								<t:selectOneMenu id="labNameMenu"
									value="#{screenDetailViewer.labName.value}"
									onchange="javascript:submit()" immediate="true"
									valueChangeListener="#{screenDetailViewer.update}"
									styleClass="inputText selectMenu">
									<f:selectItems
										value="#{screenDetailViewer.labName.selectItems}" />
								</t:selectOneMenu>
							</ui:define>
							<ui:define name="editableLeadScreener">
								<t:selectOneMenu id="leadScreenerMenu"
									value="#{screenDetailViewer.leadScreener.value}"
									styleClass="inputText selectMenu">
									<f:selectItems
										value="#{screenDetailViewer.leadScreener.selectItems}" />
								</t:selectOneMenu>
							</ui:define>
						</ss:screenSummaryProperties>

						<ss:property id="collaborators" label="Collaborators"
							description="Other scientists involved in carrying out the screen">
							<ui:define name="data">
								<t:panelGrid columns="1" styleClass="layoutPanel"
									rendered="#{!screenDetailViewer.editMode}">
									<t:outputText value="&lt;none&gt;" styleClass="dataText"
										rendered="#{empty screenDetailViewer.screen.collaborators}" />
									<t:dataTable id="collaborators" var="collaborator"
										value="#{screenDetailViewer.screen.collaborators}"
										styleClass="standardTable" columnClasses="column"
										rendered="#{!empty screenDetailViewer.screen.collaborators}">
										<t:column>
											<ss:user user="#{collaborator}" />
										</t:column>
									</t:dataTable>
								</t:panelGrid>
								<t:selectManyListbox id="collaboratorsEditable"
									value="#{screenDetailViewer.collaborators.value}"
									rendered="#{screenDetailViewer.editMode}" size="5"
									styleClass="inputText selectMenu">
									<f:selectItems
										value="#{screenDetailViewer.collaborators.selectItems}" />
								</t:selectManyListbox>
							</ui:define>
						</ss:property>

						<ss:propertyGroup label="Dates"
							rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}">
							<ss:property id="dateCreated" label="Created"
								description="The date the screen was originally recorded in Screensaver"
								value="#{screenDetailViewer.screen.dateCreated}" type="Date"
								rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}"
								editable="#{screenDetailViewer.editMode}" />

							<ss:property id="dateOfApplication" label="Application Date"
								description="The date the application for the screen was submitted"
								value="#{screenDetailViewer.screen.dateOfApplication}"
								type="Date"
								rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}"
								editable="#{screenDetailViewer.editMode}" />

							<ss:property id="dateDataMeetingCompleted"
								label="Data Meeting Completed"
								description="The date the data meeting was completed"
								value="#{screenDetailViewer.screen.dataMeetingComplete}"
								type="Date"
								rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}"
								editable="#{screenDetailViewer.editMode}" />
						</ss:propertyGroup>

						<ss:property id="publishableProtocol" label="Publishable Protocol"
							value="#{screenDetailViewer.screen.publishableProtocol}"
							rendered="#{screenDetailViewer.allowedAccessToScreenDetails}"
							editable="#{screenDetailViewer.editMode}"
							description="A publication-quality description of the protocol used for this screen"
							type="Textarea" editWidth="80" editHeight="3" />

						<ss:property id="summary" label="Summary"
							value="#{screenDetailViewer.screen.summary}"
							rendered="#{screenDetailViewer.allowedAccessToScreenDetails}"
							editable="#{screenDetailViewer.editMode}"
							description="A summary of the screen" type="Textarea"
							editWidth="80" editHeight="3" />

						<ss:property id="comments" label="Comments"
							value="#{screenDetailViewer.screen.comments}"
							rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}"
							editable="#{screenDetailViewer.editMode}"
							description="Administrative comments" type="Textarea"
							editWidth="80" editHeight="3" />

						<ss:property id="publications" label="Publications"
							description="Publications reporting results of the screen">
							<ui:define name="data">
								<t:panelGrid columns="1">
									<t:outputText value="&lt;none&gt;" styleClass="dataText"
										rendered="#{empty screenDetailViewer.screen.publications}" />
									<t:dataTable id="publications" var="publication"
										value="#{screenDetailViewer.publicationsDataModel}"
										preserveDataModel="false"
										rendered="#{!empty screenDetailViewer.screen.publications}"
										styleClass="standardTable" rowClasses="row1,row2"
										columnClasses="column" headerClass="tableHeader">
										<t:column>
											<f:facet name="header">
												<t:outputText value="Pubmed ID" />
											</f:facet>
											<t:inputText value="#{publication.pubmedId}"
												rendered="#{screenDetailViewer.editMode}"
												styleClass="inputText" />
											<h:outputLink
												value="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi"
												rendered="#{!screenDetailViewer.editMode}">
												<f:param name="cmd" value="Search" />
												<f:param name="db" value="PubMed" />
												<f:param name="term" value="#{publication.pubmedId}[PMID]" />
												<t:outputText value="#{publication.pubmedId}" />
											</h:outputLink>
										</t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Year" />
											</f:facet>
											<t:inputText value="#{publication.yearPublished}"
												displayValueOnly="#{!screenDetailViewer.editMode}"
												maxlength="4" styleClass="inputText"
												displayValueOnlyStyleClass="dataText" />
										</t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Title" />
											</f:facet>
											<t:inputText value="#{publication.title}"
												displayValueOnly="#{!screenDetailViewer.editMode}"
												styleClass="inputText" displayValueOnlyStyleClass="dataText" />
										</t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Authors" />
											</f:facet>
											<t:inputText value="#{publication.authors}"
												displayValueOnly="#{!screenDetailViewer.editMode}"
												styleClass="inputText" displayValueOnlyStyleClass="dataText" />
										</t:column>
										<t:column>
											<t:commandButton value="Delete" image="/images/delete.png"
												action="#{screenDetailViewer.deletePublication}"
												styleClass="command"
												rendered="#{screenDetailViewer.editMode}" />
										</t:column>
									</t:dataTable>
									<t:panelGroup rendered="#{screenDetailViewer.editMode}">
										<t:commandButton value="Add Publication"
											action="#{screenDetailViewer.addPublication}"
											styleClass="command" />
									</t:panelGroup>
								</t:panelGrid>
							</ui:define>
						</ss:property>

						<ss:property id="lettersOfSupport" label="Letters of Support"
							rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}"
							title="Letters of support written by screening room staff for those associated with the screen">
							<ui:define name="data">
								<t:panelGrid columns="1"
									rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}">
									<t:outputText value="&lt;none&gt;" styleClass="dataText"
										rendered="#{empty screenDetailViewer.screen.lettersOfSupport}" />
									<t:dataTable id="lettersOfSupport" var="letterOfSupport"
										value="#{screenDetailViewer.lettersOfSupportDataModel}"
										preserveDataModel="false"
										rendered="#{!empty screenDetailViewer.screen.lettersOfSupport}"
										styleClass="standardTable" rowClasses="row1,row2"
										columnClasses="column" headerClass="tableHeader">
										<t:column>
											<f:facet name="header">
												<t:outputText value="Written By" />
											</f:facet>
											<t:inputText value="#{letterOfSupport.writtenBy}"
												displayValueOnly="#{!screenDetailViewer.editMode}"
												styleClass="inputText" displayValueOnlyStyleClass="dataText" />
										</t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Written" />
											</f:facet>
											<t:inputDate id="statusDateEditable"
												value="#{letterOfSupport.dateWritten}" popupCalendar="true"
												rendered="#{screenDetailViewer.editMode}"
												styleClass="inputText" />
											<t:outputText id="statusDate"
												value="#{letterOfSupport.dateWritten}"
												rendered="#{screenDetailViewer.adminViewMode}"
												styleClass="dataText" />
										</t:column>
										<t:column>
											<t:commandButton value="Delete" image="/images/delete.png"
												action="#{screenDetailViewer.deleteLetterOfSupport}"
												styleClass="command"
												rendered="#{screenDetailViewer.editMode}" />
										</t:column>
									</t:dataTable>
									<t:panelGroup rendered="#{screenDetailViewer.editMode}">
										<t:commandButton value="Add Letter of Support"
											action="#{screenDetailViewer.addLetterOfSupport}"
											styleClass="command" />
									</t:panelGroup>
								</t:panelGrid>
							</ui:define>
						</ss:property>

						<ss:property id="attachedFiles" label="Attached Files"
							rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}"
							description="Downloadable files associated with the screen">
							<ui:define name="data">
								<t:panelGrid columns="1"
									rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}">
									<t:outputText value="&lt;none&gt;" styleClass="dataText"
										rendered="#{empty screenDetailViewer.screen.attachedFiles}" />
									<t:dataTable id="attachedFiles" var="attachedFile"
										value="#{screenDetailViewer.attachedFilesDataModel}"
										preserveDataModel="false"
										rendered="#{!empty screenDetailViewer.screen.attachedFiles}"
										styleClass="standardTable" rowClasses="row1,row2"
										columnClasses="column" headerClass="tableHeader">
										<t:column>
											<f:facet name="header">
												<t:outputText value="File Name" />
											</f:facet>
											<t:inputText value="#{attachedFile.filename}"
												displayValueOnly="#{!screenDetailViewer.editMode}"
												styleClass="inputText" displayValueOnlyStyleClass="dataText" />
										</t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Contents" />
											</f:facet>
											<t:inputText value="#{attachedFile.fileContents}"
												displayValueOnly="#{!screenDetailViewer.editMode}"
												styleClass="inputText" displayValueOnlyStyleClass="dataText" />
										</t:column>
										<t:column>
											<t:commandButton value="Delete" image="/images/delete.png"
												action="#{screenDetailViewer.deleteAttachedFile}"
												styleClass="command"
												rendered="#{screenDetailViewer.editMode}" />
											<t:commandButton value="View..."
												action="#{screenDetailViewer.viewAttachedFile}"
												styleClass="command" />
										</t:column>
									</t:dataTable>
									<t:panelGroup rendered="#{screenDetailViewer.editMode}">
										<t:commandButton value="Add Attached File"
											action="#{screenDetailViewer.addAttachedFile}"
											styleClass="command" />
									</t:panelGroup>
								</t:panelGrid>
							</ui:define>
						</ss:property>

						<ss:property id="fundingSupports" label="Funding Support"
							rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}"
							description="The sources of funding support for the screen">
							<ui:define name="data">
								<t:panelGrid columns="1"
									rendered="#{screenDetailViewer.editMode || screenDetailViewer.adminViewMode}">
									<t:outputText value="&lt;none&gt;" styleClass="dataText"
										rendered="#{empty screenDetailViewer.screen.fundingSupports}" />
									<t:dataTable id="fundingSupports" var="fundingSupport"
										value="#{screenDetailViewer.fundingSupportsDataModel}"
										preserveDataModel="false"
										rendered="#{!empty screenDetailViewer.screen.fundingSupports}"
										styleClass="standardTable" rowClasses="row1,row2"
										columnClasses="column" headerClass="tableHeader">
										<t:column>
											<t:outputText value="#{fundingSupport.value}"
												styleClass="dataText" />
										</t:column>
										<t:column>
											<t:commandButton value="Delete" image="/images/delete.png"
												action="#{screenDetailViewer.deleteFundingSupport}"
												styleClass="command"
												rendered="#{screenDetailViewer.editMode}" />
										</t:column>
									</t:dataTable>
									<t:panelGroup rendered="#{screenDetailViewer.editMode}">
										<t:selectOneMenu
											value="#{screenDetailViewer.newFundingSupport}"
											required="false" styleClass="inputText selectMenu"
											converter="#{fundingSupportConverter}">
											<f:selectItems
												value="#{screenDetailViewer.newFundingSupportSelectItems}" />
										</t:selectOneMenu>
										<t:commandButton value="Add Funding Support"
											action="#{screenDetailViewer.addFundingSupport}"
											rendered="#{screenDetailViewer.editMode}"
											disabled="#{empty screenDetailViewer.newFundingSupportSelectItems}"
											styleClass="command" />
									</t:panelGroup>
								</t:panelGrid>
							</ui:define>
						</ss:property>

						<ss:property id="statusItems" label="Status Items"
							rendered="#{screenDetailViewer.allowedAccessToScreenDetails}"
							description="A record of the status of the screen, such as when it was accepted, and whether it is ongoing, completed or dropped">
							<ui:define name="data">
								<t:panelGrid columns="1">
									<t:outputText value="&lt;none&gt;" styleClass="dataText"
										rendered="#{empty screenDetailViewer.screen.statusItems}" />
									<t:dataTable id="statusItems" var="statusItem"
										value="#{screenDetailViewer.statusItemsDataModel}"
										preserveDataModel="false"
										rendered="#{!empty screenDetailViewer.screen.statusItems}"
										styleClass="standardTable" rowClasses="row1,row2"
										columnClasses="column" headerClass="tableHeader">
										<t:column>
											<f:facet name="header">
												<t:outputText value="Status" />
											</f:facet>
											<t:outputText value="#{statusItem.statusValue}"
												styleClass="dataText" />
										</t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Date" />
											</f:facet>
											<t:inputDate id="statusDateEditable"
												value="#{statusItem.statusDate}" popupCalendar="true"
												rendered="#{screenDetailViewer.editMode}"
												styleClass="inputText" />
											<t:outputText id="statusDate"
												value="#{statusItem.statusDate}"
												rendered="#{!screenDetailViewer.editMode}"
												styleClass="dataText" />
										</t:column>
										<t:column rendered="#{screenDetailViewer.editMode}">
											<t:commandButton value="Delete" image="/images/delete.png"
												action="#{screenDetailViewer.deleteStatusItem}"
												styleClass="command" />
										</t:column>
									</t:dataTable>
									<t:panelGroup rendered="#{screenDetailViewer.editMode}">
										<t:selectOneMenu value="#{screenDetailViewer.newStatusValue}"
											required="false" styleClass="inputText selectMenu"
											converter="#{statusValueConverter}">
											<f:selectItems
												value="#{screenDetailViewer.newStatusValueSelectItems}" />
										</t:selectOneMenu>
										<t:commandButton value="Add Status Item"
											action="#{screenDetailViewer.addStatusItem}"
											disabled="#{empty screenDetailViewer.newStatusValueSelectItems}"
											styleClass="command" />
									</t:panelGroup>
								</t:panelGrid>
							</ui:define>
						</ss:property>

						<ss:property id="assayReadoutTypes" label="Assay Readout Types"
							rendered="#{screenDetailViewer.allowedAccessToScreenDetails}"
							description="The assay readout types used">
							<ui:define name="data">
								<t:outputText id="assayReadoutTypes"
									value="#{empty screenDetailViewer.screen.assayReadoutTypes ? '&lt;none&gt;' : screenDetailViewer.screen.assayReadoutTypesString}"
									styleClass="dataText"
									rendered="#{screenDetailViewer.allowedAccessToScreenDetails}" />
							</ui:define>
						</ss:property>

						<ss:property id="keywords" label="Keywords" type="Set"
							value="#{screenDetailViewer.screen.keywords}"
							editable="#{screenDetailViewer.editMode}"
							description="A set of keywords associated with the screen" />

						<ss:property label="Billing Information"
							rendered="#{screenDetailViewer.screensaverUser.isUserInRoleOfNameMap['billingAdmin']}"
							description="Information for tracking billing from ICCB-L to the lab performing the screen">
							<ui:define name="data">
								<t:commandButton id="viewBillingInformation"
									value="#{screenDetailViewer.editMode ? 'Edit...' : 'View...'}"
									action="#{screenDetailViewer.viewBillingInformation}"
									styleClass="command" />
							</ui:define>
						</ss:property>
					</t:panelGrid>

					<t:panelGrid id="rightSide" columns="1">

						<ss:property id="labActivities" label="Lab Activities"
							rendered="#{screenDetailViewer.allowedAccessToScreenDetails}"
							description="Activities carried out in the lab (e.g., screening a library, creating an assay plate, etc.)">
							<ui:define name="data">
								<t:panelGrid columns="1">
									<t:outputText value="&lt;none&gt;" styleClass="dataText"
										rendered="#{empty screenDetailViewer.screen.labActivities}" />
									<t:dataTable id="activityItems" var="activityItem"
										value="#{screenDetailViewer.labActivitiesDataModel}"
										preserveDataModel="false"
										rendered="#{!empty screenDetailViewer.screen.labActivities}"
										styleClass="standardTable" rowClasses="row1,row2"
										columnClasses="column" headerClass="tableHeader">
                    <t:column>
                      <f:facet name="header">
                        <t:outputText value="#" />
                      </f:facet>
                      <ss:entityLink entity="#{activityItem}" bean="#{activityViewer}" action="viewActivity"/>
                    </t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Date" />
											</f:facet>
											<t:outputText id="labActivityDate"
												value="#{activityItem.dateOfActivity}" styleClass="dataText" />
										</t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Type" />
											</f:facet>
											<t:outputText id="activityType"
												value="#{activityItem.activityTypeName}"
												styleClass="dataText" />
										</t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Performed By" />
											</f:facet>
											<t:outputText id="performedBy"
												value="#{activityItem.performedBy.fullNameLastFirst}"
												styleClass="dataText" />
										</t:column>
									</t:dataTable>
                  <t:panelGroup styleClass="commandPanel"
                    rendered="#{screenDetailViewer.editable}">
                    <t:commandButton value="Add Library Screening..."
                      action="#{screenDetailViewer.addLibraryScreening}"
                      styleClass="command" />
                  </t:panelGroup>
								</t:panelGrid>

								<t:commandButton value="Add Lab Activity..."
									action="#{screenDetailViewer.addLabActivity}"
									styleClass="command" rendered="#{screenDetailViewer.editMode}" />
							</ui:define>
						</ss:property>

						<ss:property id="cherryPickRequests" label="Cherry Pick Requests"
							rendered="#{screenDetailViewer.allowedAccessToScreenDetails}"
							description="The cherry pick requests for this screen">
							<ui:define name="data">
								<t:panelGrid columns="1">
									<t:outputText value="&lt;none&gt;" styleClass="dataText"
										rendered="#{empty screenDetailViewer.screen.cherryPickRequests}" />
									<t:dataTable id="cherryPickRequests" var="cherryPickRequest"
										value="#{screenDetailViewer.cherryPickRequestsDataModel}"
										preserveDataModel="false"
										rendered="#{!empty screenDetailViewer.screen.cherryPickRequests}"
										styleClass="standardTable" rowClasses="row1,row2"
										columnClasses="column" headerClass="tableHeader">
										<t:column>
											<f:facet name="header">
												<t:outputText value="#" />
											</f:facet>
											<ss:entityLink entity="#{cherryPickRequest}"
												bean="#{cherryPickRequestViewer}"
												property="cherryPickRequestNumber"
												action="viewCherryPickRequest" />
										</t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Date Requested" />
											</f:facet>
											<t:outputText id="dateRequested"
												value="#{cherryPickRequest.dateRequested}"
												styleClass="dataText" />
										</t:column>
										<t:column>
											<f:facet name="header">
												<t:outputText value="Requested By" />
											</f:facet>
											<t:outputText id="requestedBy"
												value="#{cherryPickRequest.requestedBy.fullNameLastFirst}"
												styleClass="dataText" />
										</t:column>
                    <t:column rendered="#{screenDetailViewer.screensaverUser.isUserInRoleOfNameMap['cherryPickAdmin']}">
											<t:commandButton value="Add Screening..."
												action="#{screenDetailViewer.addRNAiCherryPickScreening}"
												rendered="#{cherryPickRequest.screen.screenType.value == 'RNAi'}"
												styleClass="command" />
										</t:column>
									</t:dataTable>
									<t:panelGroup styleClass="commandPanel"
										rendered="#{cherryPickRequestViewer.editable}">
										<t:commandButton value="Add Cherry Pick Request..."
											action="#{screenDetailViewer.addCherryPickRequest}"
											styleClass="command" />
									</t:panelGroup>
								</t:panelGrid>
							</ui:define>
						</ss:property>

					</t:panelGrid>
				</t:panelGrid>
			</ui:define>
		</ss:collapsiblePanel>
	</h:form>

</ui:composition>

</html>

